<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Game Management App</title>
</head>
<body>
  
  <%- include('./partials/nav.ejs') %>
  <main>
    <h1>All Games</h1>
    <div class="mainContent">
      <% games.forEach((game, index)=>{ %>
        <div class="game">
          <img class="gameImg" src="<%= game.image_url %>" alt="<%= game.title %>">
          <h1 class="gameTitle"><%= game.title %></h1>
          <h2 class="gameDevelopers">Developers: <%= game.developers %></h2>
          <h2 class="gameGenres">Genres: <%= game.genres %></h2>
          <h3 class="gameReleaseDate">Release Date:
          <%= new Date(game.release_date).toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
          }) %>
          </h3>
          <div class="btn">
            <a href="/games/<%= game.id %>/edit" class="btn-edit">Edit</a>
           
            <button class="btn-delete" data-id="<%= game.id %>" style="border: none; cursor: pointer;">Delete</button>
          </div>
        </div>
     <% }) %>
     
     
    </div>
  </main>

 <%- include('./partials/footer.ejs') %>

  <script>
  document.querySelectorAll('.btn-delete').forEach(button => {
    button.addEventListener('click', async (e) => {
      
      const btn = e.currentTarget;
      const id = btn.dataset.id;
      const row = btn.closest('div.game'); 

      if (confirm('Are you sure you want to delete this?')) {
        try {
          const response = await fetch(`/games/${id}/delete`, {
            method: 'POST',
          });

          if (response.ok) {
            
            if (row) {
              row.remove();
            }
          } else {
            alert('Failed to delete on server');
          }
        } catch (err) {
          
          console.error('Network Error:', err);
        }
      }
    });
  });
 </script>




</body>
</html>